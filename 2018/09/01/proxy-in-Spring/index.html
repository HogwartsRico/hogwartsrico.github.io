<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-KR9KQDPLNN"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-KR9KQDPLNN');
	</script>
    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">







    <link rel="dns-prefetch" href="https://hm.baidu.com"/>



    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Spring中的代理 | 
        
        Rico&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content="HogwartsRico,Spring">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?uVzgA6RLrOm13Ukw8Qgy+A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Rico&#39;s Blog">
    <meta name="msapplication-starturl" content="http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Rico&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Spring中的代理 | Rico&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="Spring"> 

    
        <meta property="article:published_time" content="Sat Sep 01 2018 21:41:43 GMT+0800">
        <meta property="article:modified_time" content="Sun Dec 19 2021 18:34:24 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/index.html" />
    

    <!-- Structured-data for SEO -->
    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?54ee66f82cedec3c2b6b4ea942911185';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

<meta name="generator" content="Hexo 6.3.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%EF%BC%88Proxy%EF%BC%89"><span class="post-toc-number">1.</span> <span class="post-toc-text">代理模式（Proxy）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%87%AA%E5%B7%B1%E7%BC%96%E5%86%99Proxy%E5%92%8CClassLoader-InvocationHandler"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">自己编写Proxy和ClassLoader,InvocationHandler</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CGLib%E6%A1%88%E4%BE%8B"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">CGLib案例</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%BD%95%E6%97%B6Spring%E4%BD%BF%E7%94%A8JDK-CGLib%E4%BB%A3%E7%90%86"><span class="post-toc-number">2.</span> <span class="post-toc-text">何时Spring使用JDK&#x2F;CGLib代理</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="post-toc-number">3.</span> <span class="post-toc-text">扩展阅读:</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 28 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Spring中的代理
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Rico</strong>
        <span>9月 01, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-none-link" href="/tags/Spring/" rel="tag">Spring</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Spring中的代理&url=http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/index.html&pic=http://hogwartsrico.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Spring中的代理&url=http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/index.html&via=Rico" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="代理模式（Proxy）"><a href="#代理模式（Proxy）" class="headerlink" title="代理模式（Proxy）"></a>代理模式（Proxy）</h1><p>特点: </p>
<p>1、 有2个角色，执行者、被代理人</p>
<p>2、 对于被代理人来说，这件事情是一定要做的，但是我自己不想做或者没有时间做，找代理做</p>
<p>3、 需要获取到被代理的人个人资料，只是参与整个过程的某个或几个环节</p>
<p>生活中的案例: </p>
<p> <strong>租房中介、</strong> </p>
<p><strong>售票黄牛、</strong> </p>
<p><strong>婚介、</strong></p>
<p><strong>经纪人</strong>、</p>
<p>快递、事务代理、非侵入式日志监听   </p>
<p>应用场景：为其他对象提供一种代理以控制对这个对象的访问。从结构上来看和Decorator模式类似，但Proxy是控制，更像是一种对功能的限制，而Decorator是增加职责。</p>
<p>Spring的Proxy模式在AOP中有体现，比如JdkDynamicAopProxy和Cglib2AopProxy。</p>
<p>代码举例：租房子</p>
<p>定义一个人，要找房子</p>
<pre><code class="java">package findHouse;
public interface Person {
    String getName();
    String getAddress();
    void findHouse();
    void anotherMethod();
}
</code></pre>
<p>定义个张三，要找房子</p>
<pre><code class="java">package findHouse;
public class Zhangsan implements Person{
    private String name=&quot;张三&quot;;
    private String address=&quot;西湖&quot;;
    public void findHouse() {
        System.out.println(&quot;我是&quot;+this.getName()+&quot;,我住&quot;+this.getAddress()+&quot;附近，要租房子&quot;);
    }
    public void anotherMethod() { System.out.println(&quot;另一个方法&quot;); }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }
}
</code></pre>
<p>如果不使用任何模式，最简单的调用是这样</p>
<pre><code class="java">package findHouse;
public class TestFindHouse {
    public static void main(String[] args) {
        Person person=new Zhangsan();
        person.findHouse();
    }
}
</code></pre>
<p><img src="5.png" alt></p>
<p>但是张三是个上班族，没时间租房子，就去找中介。 </p>
<p>中介类</p>
<p>在使用动态代理时，我们需要定义一个位于代理类与委托类之间的中介类，<strong>这个中介类被要求实现InvocationHandler接口</strong> </p>
<pre><code class="java">package findHouse;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;
//中介
public class Zhongjie implements InvocationHandler{//实现这个接口才具有代理功能
    private Person target;
    //获取被代理人的个人资料
    public Object getInstance(Person target) throws Exception {
        this.target=target;
        Class clazz=target.getClass();
        ClassLoader loader=clazz.getClassLoader();
        return Proxy.newProxyInstance(loader, clazz.getInterfaces(), this);//第一个参数是ClassLoader,第二个参数是interfaces,第三个参数是InvocationHandler
    }
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println(&quot;代理开始&quot;);
        System.out.println(&quot;我是中介，你叫&quot;+this.target.getName()+&quot;,你住&quot;+this.target.getAddress()+&quot;附近，我帮你找房子,找了几个合适的你挑选一下&quot;);
        //this.target.findHouse();
        Object result = method.invoke(this.target, args);//这里其实并没有返回值
        System.out.println(&quot;代理结束&quot;);
        return result;
    }
}
</code></pre>
<p>从InvocationHandler这个名称我们就可以知道，实现了这个接口的中介类用做“调用处理器”。<strong>当我们调用代理类对象的方法时，这个“调用”会转送到invoke方法中</strong>，代理类对象作为proxy参数传入，参数method标识了我们具体调用的是代理类的哪个方法，args为这个方法的参数。这样一来，我们对代理类中的所有方法的调用都会变为对invoke的调用，这样我们可以在invoke方法中添加统一的处理逻辑（也可以根据method参数对不同的代理类方法做不同的处理）</p>
<p>中介类实现InvocationHandler接口，作为调用处理器”拦截“对代理类方法的调用</p>
<p>测试类</p>
<pre><code class="java">package findHouse;
public class TestFindHouse {
    public static void main(String[] args) {
        Zhongjie zhongjie=new Zhongjie();//中介
        try {
            Person obj=(Person)zhongjie.getInstance(new Zhangsan());
            System.out.println(&quot;代理后生成的class:&quot;+obj.getClass().getName());
            obj.findHouse();
            //obj.anotherMethod();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p><img src="6.png" alt></p>
<p>从以上代码中我们可以看到，中介类持有一个<strong>委托类对象引用，在invoke方法中调用了委托类对象的相应方法</strong>， </p>
<p> 感觉上就是 ，中介类可以在调用张三的找房方法前，先执行一些逻辑，然后调用张三的找房，然后在执行以下后续方法。</p>
<p> 有点像我们现实生活中的情况，比如你要买房，中介在你签字前做了大量工作，找房东，拿钥匙，联系贷款银行问利率，帮你算总价，分期等，你决定要买了之后你只需要签字即可(调用委托对象的相应方法)，你签完字，中介还要继续后续银行放款，权证房产证契税缴纳，房管局取送资料，最后交付。 你只需要签字付钱即可。</p>
<p> 贷款利率变了，手续流程变了，你不需要关心，你只要签字，脏活累活业务强相关的代理类帮你干了。 </p>
<p>在编程中也一样，某些东西流程变了，委托类不需要管，代理类帮你管好，你的核心流程不变。这样就省心多了 </p>
<p>动态代理的优势在于可以很方便的对代理类的函数进行统一的处理，而不用修改每个代理类的函数</p>
<p>原理： </p>
<p>1 拿到被代理对象的引用（张三类），然后获取它的接口</p>
<p>2 JDK代理重新生成一个类，同时实现我们给的代理对象所实现的接口 （Person接口） </p>
<p>3 把被代理对象的引用也拿到了</p>
<p>4 重新动态生成一个class字节码</p>
<p>5 然后编译 </p>
<p>你委托类(被代理类)的原始方法是不改的，只是在你前面，在你后面加了一些逻辑  </p>
<p>把JVM编译后的代理类的class字节获取到然后反编译看下 </p>
<p><img src="10.png" alt> </p>
<p><img src="11.png" alt> </p>
<p>这个this.h是什么？ 在父类Proxy中可以看到这个h</p>
<p><img src="12.png" alt> </p>
<p><img src="13.png" alt> </p>
<p>this.h就是InvocatinHandler </p>
<p><img src="14.png" alt> </p>
<p>我们把生成的proxy0.class的字节码反编译输出看下 </p>
<p><img src="7.png" alt> </p>
<p><img src="8.png" alt> </p>
<p>h就是InvocationHandler </p>
<p><img src="9.png" alt></p>
<p> 我们代码中</p>
<p><code>Proxy.newProxyInstance(loader, clazz.getInterfaces(), this)</code> 把Zhongjie的this当做第三个参数传入,所以h就是中介类</p>
<p>所以上图代码中的</p>
<p><code>this.h.invoke(this.m4.null)</code>就是调用了 zhangsan类中的invoke方法，而中介类的invoke的代码是</p>
<pre><code class="java">System.out.println(&quot;代理开始&quot;);
System.out.println(&quot;我是中介，你叫&quot;+this.target.getName()+&quot;,你住&quot;+this.target.getAddress()+&quot;附近，我帮你找房子,找了几个合适的你挑选一下&quot;);
Object result = method.invoke(this.target, args);//这里其实并没有返回值
System.out.println(&quot;代理结束&quot;);
return result;
</code></pre>
<p>其中有一行是</p>
<pre><code class="java">Object result = method.invoke(this.target, args);
</code></pre>
<p>又调用了method.lnvoke,这才真正调用了张三的实际方法，但是在调用张三方法之前和之后，就是我们在代理类中需要在调用张三方法之前需要执行的操作，达到了我们的目的</p>
<p>了解清楚代理原理和代理模式对后续看Spring源码有帮助。 修炼内功心法 </p>
<h2 id="自己编写Proxy和ClassLoader-InvocationHandler"><a href="#自己编写Proxy和ClassLoader-InvocationHandler" class="headerlink" title="自己编写Proxy和ClassLoader,InvocationHandler"></a>自己编写Proxy和ClassLoader,InvocationHandler</h2><p>根据接口生成java代码的方法</p>
<pre><code class="java">     //重新根据接口生成代码(拼代码)
     private static  String generateSourceCode(Class&lt;?&gt; interfaces) {
         //包名
         StringBuilder sourceCode=new StringBuilder(&quot;package org.rico.learnSpring.customProxy;&quot;).append(ln);//包名
         //导包
         sourceCode.append(&quot;import java.lang.reflect.Method;&quot;).append(ln).append(ln);
         //声明类
         sourceCode.append(&quot;public  class $Proxy0 implements &quot;).append(interfaces.getName()).append(&quot;{&quot;).append(ln);//这里只实现了一个，如果通用的话要写循环//这里的类名是随便的，只要.java文件和类名一样就可以了这里是$Proxy0
         sourceCode.append(&quot;  MyInvocationHandler h;&quot;).append(ln);//域 局部变量
         //构造函数
         sourceCode.append(&quot;  public $Proxy0(MyInvocationHandler h){&quot;).append(ln);//这个构造函数名应该是动态生成的，但是这里写死了,为了方便
         sourceCode.append(&quot;    this.h=h;&quot;).append(ln);
         sourceCode.append(&quot;}&quot;).append(ln);//匹配public $Proxy0的{
         for(Method m:interfaces.getMethods()){
             sourceCode.append(&quot;  public &quot;).append(m.getReturnType().getName()).append(&quot; &quot;).append(m.getName()).append(&quot;(){&quot;).append(ln);//我们的Person方法都是无参的，这里也是图简便，应该是要把参数也遍历出来的
             sourceCode.append(&quot;    try{&quot;).append(ln);
             //获取这个Method
             sourceCode.append(&quot;        Method m = &quot;).append(interfaces.getName()).append(&quot;.class.getMethod(\&quot;&quot;).append(m.getName()).append(&quot;\&quot;,new Class[0]);&quot;).append(ln);//new Class[]{}
             sourceCode.append(&quot;        this.h.invoke(this,m,null);&quot;).append(ln);
             sourceCode.append(&quot;    }catch(Throwable e){e.printStackTrace();}&quot;).append(ln);
             if(!m.getReturnType().getName().equals(&quot;void&quot;)){//如果返回值不为空,返回
                 sourceCode.append(&quot;    return null;&quot;).append(ln);//这里为了方便直接返回null
             }
             sourceCode.append(&quot;  }&quot;).append(ln);
         }
         sourceCode.append(&quot;}&quot;);//匹配public class 的 {
         return sourceCode.toString();
     }
</code></pre>
<p>生成的java代码</p>
<p><img src="15.png" alt> </p>
<p>编写的这个generageSourceCode方法也是不断尝试，直到生成的.java文件放在工程中不报错了就可以了 ,经常会出现括号不成对出现，返回值，大小写等的问题 </p>
<p>编译java文件成class文件</p>
<pre><code class="java">        //3 编译源代码 ,并且生成.class文件 
         try {
             JavaCompiler compiler= ToolProvider.getSystemJavaCompiler();//javax提供的编译器
             StandardJavaFileManager manager=compiler.getStandardFileManager(null,null,null);
             Iterable iterable=manager.getJavaFileObjects(f);//获取迭代器 就是为了找到Java文件
             JavaCompiler.CompilationTask task=compiler.getTask(null,manager,null,null,null,iterable);//编译任务
             task.call();
             manager.close();
         } catch (IOException e) {
             e.printStackTrace();
         }
</code></pre>
<p>完整源码</p>
<p>测试类</p>
<pre><code class="java">package org.rico.learnSpring.customProxy;
import org.rico.learnSpring.findHouse.Person;
import org.rico.learnSpring.findHouse.Zhangsan;
public class TestFindHouse {
    public static void main(String[] args) {
        MyZhongjie zhongjie=new MyZhongjie();//中介
        try {
            Person obj=(Person)zhongjie.getInstance(new Zhangsan());//代理出来的对象可以强转成接口的 ，当然zhangsan也要实现Person
            System.out.println(&quot;代理后生成的class:&quot;+obj.getClass().getName());
            obj.findHouse();
            //obj.anotherMethod();
        } catch (Exception e){
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>中介类 MyZhongjie.java</p>
<pre><code class="java">package org.rico.learnSpring.customProxy;
import org.rico.learnSpring.findHouse.Person;
import java.lang.reflect.Method;
//房屋中介类
public class MyZhongjie implements MyInvocationHandler{
    private Person target;
    //获取被代理人的个人资料
    public Object getInstance(Person target) throws Exception {
        this.target=target;
        Class clazz=target.getClass();
        System.out.println(&quot;被代理对象的class是:&quot;+clazz.getName());        
        return MyProxy.newProxyInstance(new MyClassLoader(), clazz.getInterfaces(), this);//第一个参数是ClassLoader,第二个参数是interfaces,第三个参数是InvocationHandler也即本身，因为zhongjie本身实现了InvocationHandler
    }
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println(&quot;代理开始&quot;);
        System.out.println(&quot;我是中介，你叫&quot;+this.target.getName()+&quot;,你住&quot;+this.target.getAddress()+&quot;附近，我帮你找房子,找了几个合适的你挑选一下&quot;);
        Object result = method.invoke(this.target, args);//这里其实并没有返回值
        System.out.println(&quot;代理结束&quot;);
        return result;
    }
}
</code></pre>
<p>其中用到了MyProxy和MyInvocationhandler接口还有MyClassLoader</p>
<p>代理类MyProxy.java的newProxyInstance会生成新的java源码并编译成class然后classLoader会加载进JVM,gtInstance方法return的就是这个新生成并加载的class 然后用Person接口来接收(在测试类中)，然后调用findHouse时就调用了这个新生成的类的findHouse(见上图新“生成的类”) 而这个findHouse方法又调用了中介的invoke方法，当然会把实际调用的方法名也传入，例如findhouse，然后调到了中介的invoke方法，中介的invoke方法是</p>
<pre><code class="java">System.out.println(&quot;代理开始&quot;);
System.out.println(&quot;我是中介，你叫&quot;+this.target.getName()+&quot;,你住&quot;+this.target.getAddress()+&quot;附近，我帮你找房子,找了几个合适的你挑选一下&quot;);
Object result = method.invoke(this.target, args);//这里其实并没有返回值
System.out.println(&quot;代理结束&quot;);
return result;
</code></pre>
<p>其中有一行是</p>
<pre><code class="java">Object result = method.invoke(this.target, args);
</code></pre>
<p>又调用了method.lnvoke,这才真正调用了张三的实际方法，但是在调用张三方法之前和之后，就是我们在代理类中需要在调用张三方法之前需要执行的操作，达到了我们的目的</p>
<p>下面是MyProxy的代码</p>
<pre><code class="java">package org.rico.learnSpring.customProxy;
import javax.tools.JavaCompiler;
import javax.tools.StandardJavaFileManager;
import javax.tools.ToolProvider;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;
//这个类会生成代理对象的代码
public class MyProxy {
    private static  final String  ln=&quot;\n&quot;;//换行
     //这个方法很重要 用于生成代理对象的代码
     public static Object newProxyInstance(MyClassLoader loader,  Class&lt;?&gt;[] interfaces,  MyInvocationHandler h) {
         //1 生成源代码
         String proxySourceCode=generateSourceCode(interfaces[0]);
         //2 将生成的源代码输出到磁盘，保存为.java文件
         final String filePath = MyProxy.class.getResource(&quot;&quot;).getPath();
         //final String filePath = &quot;C:\\Users\\chenhongjie\\Desktop\\&quot;;
         File f= new File(filePath+&quot;$Proxy0.java&quot;);//.java文件名和类名一致
         try {
             FileWriter fw=new FileWriter(f);
             fw.write(proxySourceCode);
             fw.flush();
             fw.close();
         } catch (IOException e) {
             e.printStackTrace();
         }
         //3 编译源代码 ,并且生成.class文件 
         try {
             JavaCompiler compiler= ToolProvider.getSystemJavaCompiler();//javax提供的编译器
             StandardJavaFileManager manager=compiler.getStandardFileManager(null,null,null);
             Iterable iterable=manager.getJavaFileObjects(f);//获取迭代器 就是为了找到Java文件
             JavaCompiler.CompilationTask task=compiler.getTask(null,manager,null,null,null,iterable);//编译任务
             task.call();
             manager.close();
             //4 通过MyClassLoader将class文件中的内容动态加载到JVM中来
             Class  proxyClass=loader.findClass(&quot;$Proxy0&quot;);
             Constructor c=proxyClass.getConstructor(MyInvocationHandler.class);//定义构造函数
             f.delete();//获取到构造函数后可以把源文件删掉 JDK是这么做的，当然你也可以不删
             //5 返回被代理后的代理对象
             return c.newInstance(h);
         } catch (Exception e) {
             e.printStackTrace();
         }
         return null;
     }

     //重新根据接口生成代码(拼代码)
     private static  String generateSourceCode(Class&lt;?&gt; interfaces) {
         //包名
         StringBuilder sourceCode=new StringBuilder(&quot;package org.rico.learnSpring.customProxy;&quot;).append(ln);//包名
         //导包
         sourceCode.append(&quot;import java.lang.reflect.Method;&quot;).append(ln).append(ln);
         //声明类
         sourceCode.append(&quot;public  class $Proxy0 implements &quot;).append(interfaces.getName()).append(&quot;{&quot;).append(ln);//这里只实现了一个，如果通用的话要写循环//这里的类名是随便的，只要.java文件和类名一样就可以了这里是$Proxy0
         sourceCode.append(&quot;  MyInvocationHandler h;&quot;).append(ln);//域 局部变量
         //构造函数
         sourceCode.append(&quot;  public $Proxy0(MyInvocationHandler h){&quot;).append(ln);//这个构造函数名应该是动态生成的，但是这里写死了,为了方便
         sourceCode.append(&quot;    this.h=h;&quot;).append(ln);
         sourceCode.append(&quot;}&quot;).append(ln);//匹配public $Proxy0的{
         for(Method m:interfaces.getMethods()){
             sourceCode.append(&quot;  public &quot;).append(m.getReturnType().getName()).append(&quot; &quot;).append(m.getName()).append(&quot;(){&quot;).append(ln);//我们的Person方法都是无参的，这里也是图简便，应该是要把参数也遍历出来的
             sourceCode.append(&quot;    try{&quot;).append(ln);
             //获取这个Method
             sourceCode.append(&quot;        Method m = &quot;).append(interfaces.getName()).append(&quot;.class.getMethod(\&quot;&quot;).append(m.getName()).append(&quot;\&quot;,new Class[0]);&quot;).append(ln);//new Class[]{}
             sourceCode.append(&quot;        this.h.invoke(this,m,null);&quot;).append(ln);
             sourceCode.append(&quot;    }catch(Throwable e){e.printStackTrace();}&quot;).append(ln);
             if(!m.getReturnType().getName().equals(&quot;void&quot;)){//如果返回值不为空,返回
                 sourceCode.append(&quot;    return null;&quot;).append(ln);//这里为了方便直接返回null
             }
             sourceCode.append(&quot;  }&quot;).append(ln);
         }
         sourceCode.append(&quot;}&quot;);//匹配public class 的 {
         return sourceCode.toString();
     }
}
</code></pre>
<p>MyClassLoader.java的代码</p>
<pre><code class="java">package org.rico.learnSpring.customProxy;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
//实现了代码生成，编译，动态重新load到JVM中
public class MyClassLoader extends ClassLoader {
    private final File baseDir;
    public MyClassLoader(){
        final String basePath=MyClassLoader.class.getResource(&quot;&quot;).getPath();
        this.baseDir=new File(basePath);
    }
    @Override
    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {
        //加载到JVM中来
        String className=MyClassLoader.class.getPackage().getName()+&quot;.&quot;+name;
        System.out.println(className);
        if(baseDir!=null){
            File classFile=new File(baseDir,name.replace(&quot;\\.&quot;,&quot;/&quot;)+&quot;.class&quot;);//点.替换成斜杠/
            if(classFile.exists()){
                FileInputStream in=null;
                try{
                    in =new FileInputStream(classFile);
                    ByteArrayOutputStream out=new ByteArrayOutputStream();
                    byte [] buff=new byte[1024];
                    int len;
                    while ((len=in.read(buff))!=-1){
                        out.write(buff,0,len);;
                    }
                    out.close();
                    return defineClass(className,out.toByteArray(),0,out.size());
                }catch (Exception e){
                   e.printStackTrace();
                }finally {
                    if(null!=in){
                        try {
                            in.close();
                        } catch (IOException e) {
                            e.printStackTrace();
                        }
                    }
                    classFile.delete();//加载到jvm后delete掉(要在in，out都删掉之后再关) JDK是删掉的，当然你也可以不删掉
                }
            }
        }
        return null;        
    }
}
</code></pre>
<p>MyInvocationHandler.java的代码</p>
<p>JDK原生的InvocationHandler也是一个接口，用于代理类来实现的,本例中就是中介</p>
<pre><code class="java">package org.rico.learnSpring.customProxy;
import java.lang.reflect.Method;
public interface MyInvocationHandler{
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable;
}
</code></pre>
<p>代理成功!</p>
<p><img src="16.png" alt></p>
<p>通过这个案例就理解了JDK动态代理的原理,真正是如何实现的 </p>
<p>复习一下原理</p>
<pre><code>拿到被代理对象的引用（张三类），然后获取它实现的接口接口也就是Person
JDK代理重新生成一个类，同时实现我们给的代理对象所实现的接口 （Person接口）给每个方法内部实现都写成this.h.invoke,这样就变成了调用中介类的invoke，当然也会把实际需要调用的方法名传入给中介的invoke以便执行完代理逻辑前/后调用真正的方法
</code></pre><p>总结一下有点像狸猫换太子：新生成一个类，类里的所有方法都去调用代理类的那个invoke方法，同时把真正需要调用的方法名也传入。 然后代理类的invoke就被执行了，然后代理类的invoke在执行代理逻辑时再调用下真实那个被代理类的那个方法 </p>
<p>总结：字节码重组 </p>
<p>上面的JDK的动态代理一定要写一个接口,例如案例中的Person(张三实现了Person接口，所以在张三类中可以拿到它实现的接口也就是Person),因为我们生成的class文件需要实现这个接口,所以必须要这个接口，否则实现不了。CGlib不需要接口就可以实现动态代理 </p>
<p>代理的实现分<strong>动态代理</strong>和<strong>静态代理</strong>    </p>
<p>静态代理的实现是对已经生成了的JAVA类进行封装。</p>
<p>动态代理则是在运行时生成了相关代理类，在JAVA中生成动态代理一般有两种方式</p>
<ul>
<li>JDK实现代理生成，是用类 java.lang.reflect.Proxy, 实现方式 就是上面这个案例 </li>
<li>用CGLib实现  <a href="http://cglib.sourceforge.net/" target="_blank" rel="noopener">CGLIB</a>是一个开源项目 </li>
</ul>
<p>Spring中，bean都是由动态代理生成出来的 <strong>Spring AOP中，当拦截对象实现了接口时，生成方式是用JDK的Proxy类。当没有实现任何接口时用的是GCLIB开源项目生成的拦截类的子类.</strong>    Spring是集成了CGLib的  </p>
<p>CGLib的实现原理: 自动生成一个类，继承自己的那个被代理类，然后把子类的引用指向父 类 ,同样是做了字节码重组，</p>
<p>好处就是可以少写一个接口 ,对于使用API的用户来说是无感知的  </p>
<h2 id="CGLib案例"><a href="#CGLib案例" class="headerlink" title="CGLib案例"></a>CGLib案例</h2><p>Zhangsan.java 张三</p>
<pre><code class="java">public class Zhangsan {
    public void findHouse(){
        System.out.println(&quot;我要找房子&quot;);
    }
}
</code></pre>
<p>中介 Zhongjie.java </p>
<pre><code class="java">public class Zhongjie implements MethodInterceptor {//interceptor的英文意思是拦截机
    public Object getInstance (Class clazz) throws  Exception{
        //通过反射机制，实例化
        Enhancer enhancer=new Enhancer();
        //把父类设置为谁?
        enhancer.setSuperclass(clazz);//传入被代理对象的Class,这一步就是告诉cglib，生成的子类需要继承哪个类
        enhancer.setCallback(this);//设置回调 后续this.h.invoke调用的是本身的intercept方法
        return enhancer.create();//第一步生成源代码,第二步编译Class,第三步加载到JVM中,并返回被代理后的对象

    }
    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {//这里的obj并不是我们new出来的被代理对象的引用，而是被代理对象的class
        System.out.println(&quot;代理开始&quot;);
        System.out.println(&quot;被调用的方法名:&quot;+method.getName());
        //这个obj的引用是由CGLib给我们new出来的,CGLib new出来以后的对象是被代理对象的子类(继承了我们自己写的那个被代理对象也就是Zhangsan.java)
        //new子类的同时，必须先new出父类来，这就相当于是间接的持有了我们父类的引用,子类重写了父类的所有的方法,变成类似于this.h.invoke(...),我们改变子类对象的某些属性是可以间接的操作父类的属性的
        Object result=methodProxy.invokeSuper(obj,args);//一定是调Super,这里调用Super其实就是原始的那个被代理对象的那个原始方法.不能写Invoke不然会死循环 相当于在findHose中调用findHouse
        System.out.println(&quot;代理结束&quot;);
        return result;
    }
}
</code></pre>
<p>测试类,main方法</p>
<pre><code class="java">public static void main(String[] args) {
        //JDK的动态代理是通过接口来进行强制转换的,生成以后的代理对象可以强制转换为接口
        //CGLib的动态代理是通过生成一个被代理对象的子类，然后重写父类的方法,生成以后的对象时可以强制转换为被代理对象,子类引用赋值给父类
        Zhongjie zhongjie =new Zhongjie();
        try{
            //Zhangsan zhangsan=(Zhangsan)zhongjie.getInstance(new Zhangsan());//其实没用到这个对象的引用，只需要它的class，这样写只是方便，在Zhongjie.java中也是obj.getClass,为了不避免误会，采用下面的方式
            Zhangsan zhangsan=(Zhangsan)zhongjie.getInstance(Zhangsan.class);
            zhangsan.findHouse();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
</code></pre>
<p>代理模式用的最多的就是SpringAOP </p>
<p>可以做什么事情？可以在每一个方法调用之前加一些代码，在方法调用之后再加一些代码</p>
<p><strong>AOP一般用在哪里</strong> :事务代理(声明式事务,哪个方法需要加事务，哪个方法不需要加事务s)、日志</p>
<p>在调用service方法之前开启(open)一个事务，<strong>事务的执行是由我们自己的代码完成的</strong>，事务执行完成后监听是否有异常，可能要根据异常的类型来决定这个事务是否要回滚(rollaback)还是继续提交(commit)，最后事务还要关闭(close) </p>
<p>上面的流程中，除了事务的执行(加粗部分)，其他操作都是AOP帮我们做的 </p>
<p>AOP是通过代理这种技术来实现的，AOP不是代理，代理也不是AOP</p>
<h1 id="何时Spring使用JDK-CGLib代理"><a href="#何时Spring使用JDK-CGLib代理" class="headerlink" title="何时Spring使用JDK/CGLib代理"></a>何时Spring使用JDK/CGLib代理</h1><p>当有接口时使用JDK动态代理，没有时使用CGLib动态代理。  </p>
<p>当proxyTargetClass为true是不管什么情况都使用CGLib   </p>
<h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读:"></a>扩展阅读:</h1><p><a href="https://www.jianshu.com/p/cbd58642fc08" target="_blank" rel="noopener">十分钟理解Java之动态代理</a>  </p>
<p><a href="https://www.jianshu.com/p/942a4a349ac4" target="_blank" rel="noopener">https://www.jianshu.com/p/942a4a349ac4</a></p>
<p><a href="https://www.jianshu.com/p/774c65290218" target="_blank" rel="noopener">https://www.jianshu.com/p/774c65290218</a></p>
<p><a href="https://www.cnblogs.com/lianghaoc/p/5699537.html" target="_blank" rel="noopener">https://www.cnblogs.com/lianghaoc/p/5699537.html</a></p>
<p><a href="https://segmentfault.com/a/1190000007089902" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007089902</a></p>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                         
                            This blog is under a CC BY-NC-SA 3.0 Unported License
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/">http://hogwartsrico.github.io/2018/09/01/proxy-in-Spring/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/11/11/write-a-spring/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/10/01/Introduction-of-Lucene/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Rico's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        chenhongjie101@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:chenhongjie101@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2023/09/">九月 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2023/03/">三月 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/12/">十二月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/08/">八月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/07/">七月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/06/">六月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/02/">二月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/12/">十二月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/09/">九月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/02/">二月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/11/">十一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">一月 2015<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">57</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/Ricoccc" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/rico.austin.5" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://plus.google.com/u/0/103668464393164710629" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    
        <a href="https://weibo.com/1878017080/profile" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    
        <a href="https://www.instagram.com/hogwartsrico/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-instagram">
                <span class="visuallyhidden">Instagram</span>
            </button><!--
     --></a>
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/HogwartsRico" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    
        <a href="https://space.bilibili.com/14573494" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-bilibili">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    
        <a href="https://v2ex.com/member/Rico" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-v2ex">
                <span class="visuallyhidden">V2EX</span>
            </button><!--
     --></a>
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;Rico's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>-->
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?LT4t6iE6m8TO1BLGGiNJqA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==", true)</script>
    











<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2014;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
